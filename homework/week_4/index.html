<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <link rel="stylesheet" href="style.css">
        <title>Child vaccination</title>
        <script type="text/javascript" src="d3/d3.js"></script>
    </head>
    <body>
      <!-- This is where your bar chart will go -->
        <script type="text/javascript">
          var body = d3.select("body")
          body
            .append("h1")
            .text("Child vaccination Europe");
          body
            .append("p")
            .html("Kimberley Boersma <br> 11003464")
          body
            .append("p")
            .html("The dataset contains the child vaccination rates for several countries. <br>I'd like to visualize this data with a bar chart taking the average of all the vaccination types for 2016 for every country.")

          var w = 1200;
          var h = 220;
          var barPadding = 1;
          // var svg = body
          //   .append("svg")
          //   .attr("width", w)
          //   .attr("height", h);
            var margin = {
                          top: 20,
                          left: 50,
                          right: 30,
                          bottom: 30
                        };
              var barwidth = 80
              var padding = 5
              var svg = d3.select("body")
                          .append("svg")
                          .attr("width", w)
                          .attr("height", h)
                          .attr("transform", "translate(" + margin.top + "," + margin.left + ")");
              w_domain = w - margin.left - margin.right;
              h_domain = h - margin.top - margin.bottom;

            var yscale = d3.scaleLinear()
              .range([h_domain, 0])
              .domain([0, 35]);
            var xscale = d3.scaleBand()
              .range([0, w_domain])
              .padding(0.1);

          var fileName = "childvaccination.json";
          var txtFile = new XMLHttpRequest();
          txtFile.onreadystatechange = function() {
              if (txtFile.readyState === 4 && txtFile.status == 200) {
                  data = JSON.parse(txtFile.responseText);
                  execute(data)
                  make_axis()
                  barchart(percentage)
          }
        }
          txtFile.open("GET", fileName);
          txtFile.send();

          function indexKeys(data){
              keys = Object.keys(data)
              return keys
          };

          function returnKeys(data, keys){
              keys.forEach(function(key) {
              values = data[key];
              arrayKeys = Object.keys(values)
              });
              return arrayKeys
          };

          function returnValues(keys, column){
            arrayValues = []
            keys.forEach(function(key){
              arrayValues.push(data[key][column])
            });
            return arrayValues
          };

          function execute(data){
            index = indexKeys(data)
            console.log(index)
            keys = returnKeys(data, index)
            console.log(keys)
            countries = returnValues(index, keys[0])
            console.log(countries)
            years = returnValues(index, keys[1])
            console.log(years)
            percentage = returnValues(index, keys[2])
            console.log(percentage)
          }

          function make_axis(){
        var xaxis = d3.axisBottom(xscale);

        var yaxis = d3.axisLeft(yscale);

        svg.append('g')
            .attr('transform', 'translate('+[0, h_domain]+')')
            .attr('class', 'x axis')
            .call(xaxis);}

          function barchart(dataset){
            var rectangles = svg.selectAll("rect")
                   .data(dataset)
                   .enter()
                   .append("rect")

            rectangles
               .attr("x",  function(d, i) {
               return (i * (w / dataset.length));
                 })
               .attr("y", function(d) {
                  return h - (d * 2);  //Height minus data value
                  })
               .attr("width", ((w / dataset.length) - barPadding))
               .attr("height", function(d) {
                 var barHeight = d * 2;
                 return barHeight;
               })
               .attr("fill", function(d) {
                return "rgb(" + (d * 1.8) + "," + (d * 0.8) + "," + (d * 2.5) + ")";
            });
          }

		    </script>
    </body>
</html>
