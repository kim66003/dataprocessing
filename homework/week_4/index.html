<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <link rel="stylesheet" href="style.css">
        <title>Child vaccination</title>
        <script type="text/javascript" src="d3/d3.js"></script>
    </head>
    <body>
      <!-- This is where your bar chart will go -->
        <script type="text/javascript">
  		    d3.select("body").append("h1").text("Child vaccination Europe");
          d3.select("body").append("p").text("Kimberley Boersma")
          d3.select("body").append("p").text("11003464")

          var fileName = "vaccination.json";
          var txtFile = new XMLHttpRequest();
          txtFile.onreadystatechange = function() {
              if (txtFile.readyState === 4 && txtFile.status == 200) {
                  data = JSON.parse(txtFile.responseText);
                  index = indexKeys(data)
                  console.log(index)
                  keys = returnKeys(data, index)
                  console.log(keys)
                  y = returnValues(index, keys[3])
                  console.log(y)
                  d3.select("body").selectAll("p")
            			.data(y)
            			.enter()
            			.append("p")
            			.text(function(d) { return "Percentage of vaccinated children: " + d; })
                  .style("color", function(d) {
                    if (d > 98) {   //Threshold of 15
                        return "#009109";
                    } else {
                        return "black";
                    }
                });
                  console.log(d3.selectAll("p"))
                  d3.select("body").selectAll("div")
                  .data(y)
                  .enter()
                  .append("div")
                  .attr("class", "bar")
                  .style("height", function(d) {
                    var barHeight = d * 1.5;  //Scale up by factor of 2
                    return barHeight + "px";
                  });

          }
        }
          txtFile.open("GET", fileName);
          txtFile.send();

          function indexKeys(data){
              keys = Object.keys(data)
              return keys
          };

          function returnKeys(data, keys){
              keys.forEach(function(key) {
              values = data[key];
              arrayKeys = Object.keys(values)
              });
              return arrayKeys
          };

          function returnValues(keys, column){
            arrayValues = []
            keys.forEach(function(key){
              arrayValues.push(data[key][column])
            });
            return arrayValues
          };

		    </script>
    </body>
</html>
