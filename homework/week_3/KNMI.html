<!DOCTYPE html>
<!-- Name: Kimberley Boersma
     Student no.: 11003464
     HTML for KNMI data from De Bilt -->

<html>
  <head>
    <title>Whale's website</title>
  </head>
  <body>

    <h1>Duration of precipitation (in 0.1 hours)</h1>
    <canvas id="myCanvas" width="1000" height="700" style="border: 1px solid #000000;">
    </canvas>
    <script>
    var fileName = "KNMI_20161231.json";
    var txtFile = new XMLHttpRequest();
    txtFile.onreadystatechange = function () {
        if (txtFile.readyState === 4 && txtFile.status == 200) {
            data = JSON.parse(txtFile.responseText)
            dates = printDates(data)
            yValues = arrayValues(dates, "DR")
            yKeys = weatherArray(data, dates)
            xKeys = arrayDates(dates)
            rangeY = calcRange(10, 460)
            rangeX = calcRange(50, 820)
            domainY = calcDomain(yValues)
            console.log(domainY)
            domainX = calcDomain(xKeys)
            transformedX = createTransform(domainX, rangeX, xKeys)
            transformedY = createTransform(domainY, rangeY, yValues)
            months = axisX(xKeys)
            console.log(months)
            domainMonths = calcDomain(months)
            console.log(domainMonths)
            transformAxisX = createTransform(domainMonths, rangeX, months)
            console.log(transformAxisX)
            yAxis = axisY(yValues)
            console.log(yAxis)
            domainAxisY = calcDomain(yAxis)
            transformAxisY = createTransform(domainAxisY, rangeY, yAxis)
            console.log(transformAxisY)
            graph = lineairGraph(transformedX, transformedY, rangeY)
            console.log(graph)
            chartDrawing(graph, transformAxisY)
        }
    }
    txtFile.open("GET", fileName);
    txtFile.send();

    function printDates(data){
      dates = Object.keys(data)
      return dates
    }

    function arrayDates(dates){
      arrayDays = []
      count = 0
      dates.forEach(function(date){
        arrayDays.push(count)
        count += 1
      });
      return arrayDays
    }

    function axisX(array){
      monthsArray = []
      months = Math.floor(array.length/30)
      for (i = 0; i < months; i++) {
          monthsArray.push(i)
          };
      return monthsArray
    }

    function axisY(array){
      arrayAxisY = []
      max = Math.max.apply(null, array)
      pointsAxisY = Math.floor(max/10)
      x = pointsAxisY
      for (i = 0; i < 10; i++) {
          arrayAxisY.push(x)
          x += pointsAxisY
          };
      return arrayAxisY
    }

    function arrayValues(dates, weather){
      arrayValues = []
      dates.forEach(function printValues(date) {
        value = parseInt(data[date][weather], 10)
        arrayValues.push(value)
      });
      return arrayValues
    }

    function weatherArray(data, dates){
      weatherKeys = []
      dates.forEach(function(date) {
        x = Object.keys(data[date])
      });
      weatherKeys.push(x)
      return weatherKeys
    }

    function calcRange(min, max){
      arrayRange = [min, max]
      return arrayRange
    }

    function calcDomain(array){
      min = Math.min.apply(null, array)
      max = Math.max.apply(null, array)
      arrayDomain = [min, max]
      return arrayDomain
    }

    function createTransform(domain, range, array){
      var domain_min = domain[0]
      var domain_max = domain[1]
      var range_min = range[0]
      var range_max = range[1]

      var alpha = (range_max - range_min) / (domain_max - domain_min)
      var beta = range_max - alpha * domain_max

      arrayY = []
      for (i = 0; i < array.length; i++) {
          y = alpha * array[i] + beta
          arrayY.push(y)
          };
      return arrayY
    }

    function lineairGraph(arrayX, arrayY, range){
      dictY = []
      max = range[1]
      for (i = 0; i < arrayX.length; i++) {
          dictY.push({
            key:   arrayX[i],
            value: (max-(arrayY[i]))
          });
      }
      return dictY;
      }

    // Rectangle thingy
    function chartDrawing(data, data2){
      const canvas = document.getElementById('myCanvas');
      const ctx = canvas.getContext('2d');
      void ctx.strokeRect(50, 0, 770, 460);
      ctx.beginPath();
      // ctx.strokeStyle = #112233
      ctx.moveTo(data[0]["key"], data[0]["value"]);

      data.forEach(function(pair){
        ctx.lineTo(pair["key"], pair["value"]);
        ctx.moveTo(pair["key"], pair["value"]);
      })
      ctx.stroke();

      ctx.beginPath();
      // ctx.moveTo(0, data2[0]);
      // for (i = 0; i < data2.length; i++) {
      //     ctx.lineTo(10, data2[i]);
      //     ctx.moveTo(10, data2[i]);
      //     };
      ctx.moveTo(0, 460 - 10)
      ctx.lineTo(100, 460 - 30)
      ctx.stroke();
    }

    </script>
  </body>
</html>
